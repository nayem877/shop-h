<!DOCTYPE html>
<html lang="bn" data-lang="bn" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>THE MAX | v7.1 PRODUCTION SECURE</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #2ea043; --primary-dark: #238636; --bg: #0b1118; --bg2: #0d1117;
  --card: #1c2128; --card2: #22272e; --text: #e6edf3; --text2: #8b949e;
  --border: #30363d; --accent: #58a6ff; --red: #f85149; --gold: #d29922;
  --shadow: 0 8px 32px rgba(0,0,0,0.55); --radius: 14px; --header-h: 60px;
}
[data-theme="light"] {
  --bg: #f0f2f5; --bg2: #e8eaed; --card: #ffffff; --card2: #f6f8fa;
  --text: #1c1e21; --text2: #57606a; --border: #d0d7de; --shadow: 0 4px 20px rgba(0,0,0,0.12);
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Hind Siliguri', 'DM Sans', sans-serif;
  background: var(--bg); color: var(--text);
  transition: background 0.3s, color 0.3s;
  min-height: 100vh; overflow-x: hidden; line-height: 1.6;
}
#smartZoom {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98);
  z-index: 100000; justify-content: center; align-items: center;
  overflow: hidden; touch-action: none;
}
#smartZoom.open { display: flex; }
#zImg {
  max-width: 100%; max-height: 100%; object-fit: contain;
  transform-origin: center; will-change: transform; transition: transform 0.1s ease-out;
}
.close-zoom {
  position: fixed; top: 20px; right: 20px; font-size: 28px; color: #fff;
  background: rgba(255,255,255,0.1); width: 44px; height: 44px; border-radius: 50%;
  display: flex; justify-content: center; align-items: center; border: 1px solid rgba(255,255,255,0.2);
  cursor: pointer; z-index: 100001;
}
header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 0 16px; height: var(--header-h); border-bottom: 2px solid var(--primary);
  position: sticky; top: 0; background: var(--bg); z-index: 1000; backdrop-filter: blur(12px);
}
.logo { font-size: 22px; font-weight: 700; color: var(--primary); text-decoration: none; }
.menu-btn {
  width: 40px; height: 40px; border-radius: 10px; border: 1.5px solid var(--border);
  background: var(--card); color: var(--text); cursor: pointer; font-size: 18px;
  display: flex; align-items: center; justify-content: center;
}
.nav-dropdown {
  position: absolute; top: 65px; right: 16px; background: var(--card);
  border: 1.5px solid var(--border); border-radius: var(--radius); width: 240px;
  box-shadow: var(--shadow); opacity: 0; transform: translateY(-10px);
  pointer-events: none; transition: 0.2s; z-index: 2000;
}
.nav-dropdown.open { opacity: 1; transform: translateY(0); pointer-events: all; }
.menu-item {
  width: 100%; padding: 12px 16px; background: none; border: none;
  color: var(--text); display: flex; align-items: center; gap: 12px;
  cursor: pointer; font-size: 14px; font-weight: 600; text-align: left;
}
.menu-item:hover { background: rgba(46,160,67,0.1); color: var(--primary); }
.user-bar {
  display: flex; align-items: center; gap: 10px; padding: 10px 16px;
  background: rgba(46,160,67,0.06); border-bottom: 1px solid var(--border); font-size: 13px;
  min-height: 48px;
}
.user-img { width: 28px; height: 28px; border-radius: 50%; border: 1.5px solid var(--primary); }
.search-area { padding: 16px 16px 0; }
.search-bar {
  width: 100%; padding: 12px 16px; border-radius: 10px; border: 1.5px solid var(--border);
  background: var(--card); color: var(--text); font-size: 15px; outline: none;
}
.cat-scroll { display: flex; gap: 8px; padding: 12px 16px; overflow-x: auto; scrollbar-width: none; min-height: 45px; }
.cat-scroll::-webkit-scrollbar { display: none; }
.cat-chip {
  background: var(--card); border: 1.5px solid var(--border); padding: 7px 16px;
  border-radius: 20px; cursor: pointer; white-space: nowrap; font-size: 13px; transition: 0.2s;
}
.cat-chip.active { background: var(--primary); color: #fff; border-color: var(--primary); }
.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px 16px; }
.card {
  background: var(--card); border-radius: var(--radius); padding: 10px;
  border: 1px solid var(--border); display: flex; flex-direction: column; position: relative;
}
.card img { width: 100%; height: 140px; object-fit: cover; border-radius: 8px; cursor: pointer; background: var(--bg2); }
.card h4 { font-size: 13px; margin: 8px 0; height: 38px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
.card-price { color: var(--primary); font-weight: 700; font-size: 16px; margin-bottom: 8px; }
.buy-btn {
  background: var(--primary); color: #fff; padding: 10px; border-radius: 8px;
  width: 100%; border: none; font-weight: 700; cursor: pointer;
}
.admin-panel {
  display: none; margin: 12px 16px; padding: 18px; background: var(--card);
  border: 2px solid var(--primary); border-radius: var(--radius);
}
.admin-panel.open { display: block; }
.in { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); }
.modal {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
  z-index: 5000; align-items: flex-end; justify-content: center;
}
.modal.open { display: flex; }
.modal-content {
  background: var(--card); width: 100%; max-width: 500px; padding: 24px;
  border-radius: 20px 20px 0 0; max-height: 90vh; overflow-y: auto;
}
.pay-opt { display: flex; align-items: center; gap: 10px; padding: 12px; border: 1.5px solid var(--border); border-radius: 10px; margin-bottom: 10px; cursor: pointer; }
.pay-opt.active { border-color: var(--primary); background: rgba(46,160,67,0.05); }
#toast {
  position: fixed; top: -60px; left: 50%; transform: translateX(-50%);
  background: var(--primary); color: #fff; padding: 12px 24px; border-radius: 30px;
  font-weight: 700; transition: 0.4s; z-index: 1000000;
}
#toast.show { top: 20px; }
footer { padding: 30px 16px; text-align: center; border-top: 1px solid var(--border); margin-top: 20px; background: var(--bg2); }
.socials { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; }
.socials a { color: var(--text2); font-size: 22px; }
@media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); } .modal { align-items: center; padding: 20px; } .modal-content { border-radius: 20px; } }
</style>
</head>
<body>

<div id="toast"></div>

<div id="smartZoom">
    <button class="close-zoom" onclick="App.closeZoom()">&times;</button>
    <div id="zoomContainer"><img id="zImg" src="" alt="Zoom"></div>
</div>

<header>
    <a href="#" class="logo">THE MAX</a>
    <button class="menu-btn" id="menuBtn" onclick="App.toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>
    <nav class="nav-dropdown" id="navDropdown">
        <button class="menu-item" onclick="App.toggleTheme()">
            <i class="fas fa-moon"></i> <span id="txt-theme">ডার্ক থিম</span>
        </button>
        <button class="menu-item" onclick="App.toggleLang()">
            <i class="fas fa-globe"></i> <span id="txt-lang">English</span>
        </button>
        <button class="menu-item" onclick="App.checkAdmin()">
            <i class="fas fa-user-shield"></i> <span id="txt-admin">অ্যাডমিন প্যানেল</span>
        </button>
    </nav>
</header>

<div class="user-bar" id="userBar"></div>

<div class="admin-panel" id="adminPanel">
    <h3 style="margin-bottom:15px" id="txt-admin-title">পণ্য আপলোড</h3>
    <input type="text" id="pName" class="in" placeholder="পণ্যের নাম">
    <input type="text" id="pPrice" class="in" placeholder="মূল্য (৳)">
    <input type="text" id="pImg" class="in" placeholder="ছবির লিঙ্ক (URL)">
    <input type="text" id="pCat" class="in" placeholder="ক্যাটাগরি">
    <button class="buy-btn" id="btn-save" onclick="App.uploadProduct()">সংরক্ষণ করুন</button>
</div>

<div class="search-area">
    <input type="text" id="sInp" class="search-bar" placeholder="খুঁজুন..." oninput="App.render()">
</div>

<div class="cat-scroll" id="catList"></div>
<div class="grid" id="mainGrid"></div>

<div class="modal" id="orderModal">
    <div class="modal-content">
        <h3 id="txt-order-title" style="margin-bottom:15px">অর্ডার কনফার্ম করুন</h3>
        <div id="orderInfo" style="padding:12px; background:var(--bg2); border-radius:10px; margin-bottom:15px; font-size:14px"></div>
        <p style="font-size:12px; font-weight:700; margin-bottom:8px" id="txt-pay-title">পেমেন্ট মেথড:</p>
        <div class="pay-options">
            <div class="pay-opt" onclick="App.setPay('Bkash')" id="pay-Bkash"><span>Bkash</span></div>
            <div class="pay-opt" onclick="App.setPay('Nagad')" id="pay-Nagad"><span>Nagad</span></div>
        </div>
        <input type="text" id="oName" class="in" placeholder="আপনার নাম">
        <input type="text" id="oPhone" class="in" placeholder="মোবাইল নম্বর">
        <input type="text" id="oTrx" class="in" placeholder="Transaction ID">
        <button class="buy-btn" id="btn-confirm" onclick="App.placeOrder()">কনফার্ম করুন</button>
        <button class="buy-btn" style="background:#444; margin-top:10px" onclick="App.closeModal()" id="txt-close">বন্ধ করুন</button>
    </div>
</div>

<footer>
    <div class="socials">
        <a href="https://www.facebook.com/share/189TkX2vh7/" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://www.youtube.com/@TheMaxshoph" target="_blank"><i class="fab fa-youtube"></i></a>
        <a href="mailto:nayemhossen20005@gmail.com"><i class="fas fa-envelope"></i></a>
    </div>
    <p style="font-size:12px; color:var(--text2)">© 2026 THE MAX | v7.1 PRODUCTION SECURE</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
const App = (() => {
    let db, auth, unsub;
    let state = {
        products: [], cat: 'All', lang: localStorage.getItem('lang') || 'bn',
        theme: localStorage.getItem('theme') || 'dark', user: null, payMethod: '', selectedP: null,
        zoom: { scale: 1, x: 0, y: 0, dist: 0, lastX: 0, lastY: 0 }
    };

    const i18n = {
        bn: { theme: "লাইট থিম", lang: "English", admin: "অ্যাডমিন প্যানেল", adminTitle: "নতুন পণ্য যুক্ত করুন", save: "সংরক্ষণ করুন", search: "খুঁজুন...", all: "সবগুলো", order: "অর্ডার কনফার্ম করুন", pay: "পেমেন্ট মেথড:", confirm: "কনফার্ম করুন", close: "বন্ধ করুন", fail: "ব্যর্থ হয়েছে!", okOrder: "সফল হয়েছে!", empty: "কোন পণ্য পাওয়া যায়নি অথবা ডেটা লোড হচ্ছে..." },
        en: { theme: "Dark Mode", lang: "বাংলা", admin: "Admin Panel", adminTitle: "Add Product", save: "Save", search: "Search...", all: "All", order: "Confirm Order", pay: "Payment Method:", confirm: "Confirm", close: "Close", fail: "Failed!", okOrder: "Success!", empty: "No products found or loading data..." }
    };

    const toast = (msg) => {
        const el = document.getElementById('toast');
        if(el) { el.textContent = msg; el.classList.add('show'); setTimeout(() => el.classList.remove('show'), 3000); }
    };

    const safeImg = (url) => (url && url.startsWith("https://")) ? url : "https://placehold.co/400x400?text=No+Image";

    const syncUI = () => {
        const t = i18n[state.lang];
        const themeBtnTxt = document.getElementById('txt-theme');
        if(themeBtnTxt) themeBtnTxt.textContent = (state.lang === 'bn') ? (state.theme === 'dark' ? "লাইট থিম" : "ডার্ক থিম") : (state.theme === 'dark' ? "Light Mode" : "Dark Mode");
        document.getElementById('txt-lang').textContent = t.lang;
        document.getElementById('txt-admin').textContent = t.admin;
        document.getElementById('txt-admin-title').textContent = t.adminTitle;
        document.getElementById('btn-save').textContent = t.save;
        document.getElementById('sInp').placeholder = t.search;
        document.getElementById('txt-order-title').textContent = t.order;
        document.getElementById('txt-pay-title').textContent = t.pay;
        document.getElementById('btn-confirm').textContent = t.confirm;
        document.getElementById('txt-close').textContent = t.close;
    };

    return {
        init: () => {
            const config = { apiKey: "AIzaSyAoZzONz8I2W70_b4oR_7cGxbQCmDaipWg", authDomain: "shop-h-215df.firebaseapp.com", projectId: "shop-h-215df", appId: "1:60483176788:web:cdadf8c99fccb3d20620c1" };
            if (!firebase.apps.length) firebase.initializeApp(config);
            db = firebase.firestore(); auth = firebase.auth();
            document.documentElement.setAttribute('data-theme', state.theme);
            syncUI();

            auth.onAuthStateChanged(u => {
                state.user = u;
                const bar = document.getElementById('userBar'); bar.textContent = "";
                if (u) {
                    const img = document.createElement('img'); img.src = safeImg(u.photoURL); img.className = 'user-img';
                    const span = document.createElement('span'); span.textContent = u.displayName || "User";
                    bar.append(img, span);
                } else {
                    const b = document.createElement('button'); b.textContent = "Login with Google"; b.onclick = App.login;
                    b.style.cssText = "border:1px solid var(--primary); color:var(--primary); padding:4px 10px; border-radius:6px; background:none; cursor:pointer";
                    bar.append(b);
                }
            });

            unsub = db.collection('products').orderBy('createdAt', 'desc').onSnapshot(snap => {
                state.products = snap.docs.map(d => ({id: d.id, ...d.data()})); 
                App.render();
            }, err => {
                console.error("Firestore Error:", err);
                toast("Database Error! Check Rules.");
            });

            window.addEventListener("beforeunload", () => { if(unsub) unsub(); });
            document.addEventListener('keydown', e => { if(e.key === "Escape"){ App.closeZoom(); App.closeModal(); App.closeMenu(); }});
        },
        login: async () => { try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); } catch(e){ toast(i18n[state.lang].fail); }},
        toggleMenu: () => { const n = document.getElementById('navDropdown'); const open = n.classList.toggle('open'); document.getElementById('menuBtn').setAttribute('aria-expanded', open); },
        closeMenu: () => { document.getElementById('navDropdown').classList.remove('open'); document.getElementById('menuBtn').setAttribute('aria-expanded', 'false'); },
        toggleTheme: () => { state.theme = state.theme === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', state.theme); localStorage.setItem('theme', state.theme); syncUI(); },
        toggleLang: () => { state.lang = state.lang === 'bn' ? 'en' : 'bn'; localStorage.setItem('lang', state.lang); syncUI(); App.render(); },
        checkAdmin: () => { if(state.user && state.user.email === 'nayemhossen20005@gmail.com') document.getElementById('adminPanel').classList.toggle('open'); else alert("Denied! Please Login First."); },
        uploadProduct: async () => {
            const n = document.getElementById('pName').value.trim(), p = Number(document.getElementById('pPrice').value), i = document.getElementById('pImg').value.trim(), c = document.getElementById('pCat').value.trim() || 'Gadget';
            if(!n || !p || !i || n.length > 100) return toast(i18n[state.lang].fail);
            try { await db.collection('products').add({ name: n, price: p, img: safeImg(i), cat: c, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); toast("Success"); document.getElementById('adminPanel').classList.remove('open'); } catch(e){ toast("Fail"); }
        },
        render: () => {
            const grid = document.getElementById('mainGrid'), catsCont = document.getElementById('catList'), term = document.getElementById('sInp').value.toLowerCase();
            if(!grid || !catsCont) return;
            grid.textContent = ""; catsCont.textContent = "";
            if(state.products.length === 0){ grid.textContent = i18n[state.lang].empty; return; }
            const cats = [i18n[state.lang].all, ...new Set(state.products.map(p => p.cat))];
            cats.forEach(c => { const chip = document.createElement('div'); chip.className = `cat-chip ${ (c === state.cat || (c === i18n[state.lang].all && state.cat === 'All')) ? 'active' : ''}`; chip.textContent = c; chip.onclick = () => { state.cat = (c === i18n[state.lang].all) ? 'All' : c; App.render(); }; catsCont.append(chip); });
            const filtered = state.products.filter(p => (state.cat === 'All' || p.cat === state.cat) && p.name.toLowerCase().includes(term));
            filtered.forEach(p => {
                const card = document.createElement('div'); card.className = "card";
                const img = document.createElement('img'); img.src = safeImg(p.img); img.onclick = () => App.openZoom(img.src);
                const h = document.createElement('h4'); h.textContent = p.name;
                const pr = document.createElement('div'); pr.className = "card-price"; pr.textContent = `৳${p.price}`;
                const b = document.createElement('button'); b.className = "buy-btn"; b.textContent = (state.lang === 'bn' ? "অর্ডার দিন" : "Order"); b.onclick = () => App.openModal(p.id);
                card.append(img, h, pr, b); grid.append(card);
            });
        },
        openZoom: (url) => { document.getElementById('zImg').src = url; document.getElementById('smartZoom').classList.add('open'); },
        closeZoom: () => { document.getElementById('smartZoom').classList.remove('open'); },
        openModal: (id) => { state.selectedP = state.products.find(p => p.id === id); if(!state.selectedP) return; document.getElementById('orderInfo').textContent = `${state.selectedP.name} - ৳${state.selectedP.price}`; document.getElementById('orderModal').classList.add('open'); },
        closeModal: () => { document.getElementById('orderModal').classList.remove('open'); state.payMethod = ""; document.querySelectorAll('.pay-opt').forEach(e => e.classList.remove('active')); },
        setPay: (m) => { state.payMethod = m; document.querySelectorAll('.pay-opt').forEach(e => e.classList.remove('active')); const target = document.getElementById(`pay-${m}`); if(target) target.classList.add('active'); },
        placeOrder: async () => {
            const n = document.getElementById('oName').value.trim(), ph = document.getElementById('oPhone').value.trim(), trx = document.getElementById('oTrx').value.trim();
            if(!n || !ph || !trx || !state.payMethod || !/^[0-9]{6,15}$/.test(ph)) return toast("Invalid Data");
            try { await db.collection('orders').add({ product: state.selectedP.name, customer: n, phone: ph, method: state.payMethod, trx: trx, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); toast(i18n[state.lang].okOrder); App.closeModal(); } catch(e){ toast("Error"); }
        }
    };
})();
window.addEventListener("DOMContentLoaded", App.init);
</script>
</body>
</html>
