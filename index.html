<!DOCTYPE html>
<html lang="bn" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE MAX | ULTIMATE PRO v12.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #2ea043; 
            --bg: #0b1118; 
            --card: #1c2128; 
            --text: #e6edf3; 
            --border: #30363d; 
            --radius: 12px; 
            --red: #f85149;
            --blue: #58a6ff;
        }

        [data-theme="light"] {
            --bg: #f6f8fa; 
            --card: #ffffff; 
            --text: #1c1e21; 
            --border: #d0d7de;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); transition: background 0.4s, color 0.4s; overflow-x: hidden; }

        /* --- Header & Navigation (Fixed mistake from video) --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 16px; border-bottom: 2px solid var(--primary);
            background: var(--bg); position: sticky; top: 0; z-index: 9999;
        }
        .logo { font-size: 26px; font-weight: 700; color: var(--primary); text-decoration: none; letter-spacing: 1px; }
        .menu-btn { 
            width: 45px; height: 45px; border-radius: 12px; border: 1.5px solid var(--border);
            background: var(--card); color: var(--text); cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 22px;
        }

        #navDropdown {
            position: fixed; top: 75px; right: 16px; background: var(--card);
            border: 2px solid var(--primary); border-radius: var(--radius);
            width: 280px; display: none; flex-direction: column; 
            z-index: 10000; box-shadow: 0 15px 50px rgba(0,0,0,0.8);
            overflow: hidden;
        }
        .user-info { padding: 18px; background: rgba(46,160,67,0.15); display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border); }
        .user-info img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); }
        .menu-link { 
            padding: 16px 20px; border: none; background: none; color: var(--text);
            text-align: left; cursor: pointer; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; gap: 12px; font-size: 15px; width: 100%; transition: 0.2s;
        }
        .menu-link:hover { background: rgba(255,255,255,0.05); color: var(--primary); }

        /* --- Search & Category (As requested) --- */
        .search-container { padding: 20px 16px; }
        .search-box {
            width: 100%; padding: 15px; border-radius: 14px; border: 1.5px solid var(--border);
            background: var(--card); color: var(--text); outline: none; font-size: 16px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .search-box:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(46,160,67,0.2); }
        
        .cat-scroll { display: flex; gap: 12px; padding: 0 16px 20px; overflow-x: auto; scrollbar-width: none; }
        .cat-scroll::-webkit-scrollbar { display: none; }
        .cat-tag {
            background: var(--card); border: 1.5px solid var(--border); padding: 8px 22px;
            border-radius: 25px; cursor: pointer; white-space: nowrap; font-size: 14px; transition: 0.3s;
        }
        .cat-tag.active { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 4px 12px rgba(46,160,67,0.3); }

        /* --- Product Grid (Design from) --- */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 0 16px 30px; }
        .card { 
            background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
            padding: 12px; display: flex; flex-direction: column; position: relative; transition: 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card img { width: 100%; height: 170px; object-fit: cover; border-radius: 10px; cursor: zoom-in; }
        .card h4 { font-size: 16px; margin: 12px 0 6px; height: 44px; overflow: hidden; line-height: 1.4; }
        .price-box { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .old-p { font-size: 13px; text-decoration: line-through; color: #888; }
        .new-p { color: var(--primary); font-weight: 700; font-size: 19px; }
        
        .meta { display: flex; justify-content: space-between; border-top: 1px solid var(--border); padding: 10px 0; margin-bottom: 10px; font-size: 13px; color: #888; }
        .meta span { cursor: pointer; }
        .meta span:hover { color: var(--primary); }
        
        .order-btn {
            width: 100%; padding: 14px; border: none; background: var(--primary);
            color: #fff; border-radius: 10px; font-weight: 700; font-size: 15px;
            cursor: pointer; transition: 0.3s;
        }
        .order-btn:active { transform: scale(0.96); }

        /* --- Video Gallery Section --- */
        .vid-section { padding: 30px 16px; background: rgba(0,0,0,0.1); }
        .sec-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; border-left: 5px solid var(--primary); padding-left: 12px; }
        .vid-row { display: flex; gap: 18px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
        .vid-card { min-width: 300px; background: var(--card); border-radius: var(--radius); overflow: hidden; border: 1.5px solid var(--border); }
        .iframe-wrap { position: relative; padding-bottom: 56.25%; height: 0; }
        .iframe-wrap iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        /* --- Lightbox / Image Zoom (Fixed) --- */
        #lightbox {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 30000; align-items: center; justify-content: center; opacity: 0; transition: 0.3s;
        }
        #lightbox.show { display: flex; opacity: 1; }
        #lightbox img { max-width: 95%; max-height: 85%; border-radius: 10px; box-shadow: 0 0 40px rgba(0,0,0,0.5); transform: scale(0.8); transition: 0.3s; }
        #lightbox.show img { transform: scale(1); }

        /* --- Modals --- */
        .overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 20000; align-items: center; justify-content: center; padding: 20px;
        }
        .overlay.open { display: flex; }
        .modal {
            background: var(--card); width: 100%; max-width: 550px; padding: 30px;
            border-radius: 20px; max-height: 92vh; overflow-y: auto; position: relative; border: 1.5px solid var(--border);
        }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 26px; cursor: pointer; color: var(--text); }
        .field { width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 10px; border: 1.5px solid var(--border); background: var(--bg); color: var(--text); outline: none; font-size: 15px; }
        .field:focus { border-color: var(--primary); }

        /* --- Footer (Added Social Links) --- */
        footer { padding: 50px 16px; text-align: center; border-top: 1px solid var(--border); background: var(--card); margin-top: 50px; }
        .socials { display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; font-size: 32px; }
        .socials a { color: var(--text); transition: 0.3s; }
        .socials a:hover { color: var(--primary); transform: translateY(-5px); }
        
        #toast { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #fff; padding: 14px 30px; border-radius: 40px; display: none; z-index: 50000; box-shadow: 0 8px 25px rgba(0,0,0,0.5); font-weight: 600; }

        @media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); } .vid-card { min-width: 450px; } }
    </style>
</head>
<body>

<div id="toast"></div>

<header>
    <a href="#" class="logo">THE MAX</a>
    <button class="menu-btn" id="menuTrigger"><i class="fas fa-bars"></i></button>
    
    <div id="navDropdown">
        <div id="userInfoBox"></div>
        <button class="menu-link" id="themeToggle"><i class="fas fa-adjust"></i> <span id="labelTheme">থিম পরিবর্তন</span></button>
        <button class="menu-link" id="langToggle"><i class="fas fa-language"></i> <span id="labelLang">English / বাংলা</span></button>
        <button class="menu-link" id="adminPanelBtn" style="display:none"><i class="fas fa-shield-alt"></i> <span id="labelAdmin">অ্যাডমিন প্যানেল</span></button>
        <button class="menu-link" id="logoutBtn" style="display:none"><i class="fas fa-power-off"></i> <span id="labelLogout">লগআউট</span></button>
        <button class="menu-link" id="loginBtn"><i class="fab fa-google"></i> <span id="labelLogin">লগইন করুন</span></button>
    </div>
</header>

<main class="search-container">
    <input type="text" id="pSearch" class="search-box" placeholder="আপনার পছন্দের পণ্যটি খুঁজুন...">
</main>

<div class="cat-scroll" id="catDisplay"></div>

<div class="grid" id="pDisplay"></div>

<div class="vid-section">
    <div class="sec-title" id="labelVidTitle">প্রোডাক্ট ভিডিও গ্যালারি</div>
    <div class="vid-row" id="vidDisplay"></div>
</div>

<div id="lightbox" onclick="TheMax.closeZoom()">
    <img id="zoomImg" src="">
</div>

<div class="overlay" id="adminModal">
    <div class="modal">
        <i class="fas fa-times close-btn" onclick="TheMax.toggleModal('adminModal', false)"></i>
        <h3 id="labelAdminHead">অ্যাডমিন কন্ট্রোল সেন্টার</h3><br>
        <div style="display:flex; gap:10px; margin-bottom:25px;">
            <button class="cat-tag active" id="btnTabAdd">পণ্য যোগ</button>
            <button class="cat-tag" id="btnTabOrders">অর্ডার লিস্ট</button>
            <button class="cat-tag" id="btnTabManage">পণ্য লিস্ট</button>
        </div>

        <div id="panelAdd">
            <input type="text" id="inName" class="field" placeholder="পণ্যের নাম">
            <div style="display:flex; gap:10px;">
                <input type="number" id="inPrice" class="field" placeholder="বিক্রয় মূল্য">
                <input type="number" id="inOldPrice" class="field" placeholder="আগের মূল্য (ঐচ্ছিক)">
            </div>
            <input type="text" id="inImg" class="field" placeholder="ছবির ডিরেক্ট লিঙ্ক (Direct URL)">
            <input type="text" id="inCat" class="field" placeholder="ক্যাটাগরি">
            <input type="text" id="inVid" class="field" placeholder="YouTube Video ID (যেমন: dQw4w9WgXcQ)">
            <textarea id="inDesc" class="field" placeholder="পণ্যের বিস্তারিত বিবরণ" rows="4"></textarea>
            <button class="order-btn" id="btnSaveProd">পণ্য সেভ করুন</button>
        </div>

        <div id="panelOrders" style="display:none">
            <div id="orderListView"></div>
        </div>

        <div id="panelManage" style="display:none">
            <div id="productManageView"></div>
        </div>
    </div>
</div>

<div class="overlay" id="orderModal">
    <div class="modal">
        <i class="fas fa-times close-btn" onclick="TheMax.toggleModal('orderModal', false)"></i>
        <h3 id="labelOrderHead">অর্ডার নিশ্চিত করুন</h3><br>
        <div id="orderSummary" style="padding:15px; background:rgba(0,0,0,0.1); border-radius:12px; margin-bottom:20px; font-size:14px; line-height:1.6;"></div>
        
        <input type="text" id="cN" class="field" placeholder="আপনার পূর্ণ নাম">
        <input type="text" id="cP" class="field" placeholder="মোবাইল নম্বর">
        <textarea id="cA" class="field" placeholder="পূর্ণ ঠিকানা (গ্রাম, থানা, জেলা)" rows="2"></textarea>
        <input type="text" id="cT" class="field" placeholder="বিকাশ/নগদ/রকেট TrxID (যদি পেমেন্ট করে থাকেন)">
        
        <button class="order-btn" id="btnFinalOrder">অর্ডার সম্পন্ন করুন</button>
    </div>
</div>

<footer>
    <div class="socials">
        <a href="https://wa.me/8801788350024" target="_blank"><i class="fab fa-whatsapp"></i></a>
        <a href="https://www.facebook.com/share/189TkX2vh7/" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://www.youtube.com/@TheMaxshoph" target="_blank"><i class="fab fa-youtube"></i></a>
        <a href="mailto:nayemhossen20005@gmail.com"><i class="fas fa-envelope"></i></a>
    </div>
    <p id="labelCopy">© 2026 THE MAX | 01788350024</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
const TheMax = (() => {
    let db, auth;
    let state = { products: [], orders: [], user: null, cat: 'All', lang: 'bn', selP: null };

    // Translation Data (Fixed Mistake)
    const words = {
        bn: { theme: "থিম পরিবর্তন", lang: "English / বাংলা", admin: "অ্যাডমিন প্যানেল", logout: "লগআউট", login: "লগইন করুন", search: "আপনার পছন্দের পণ্যটি খুঁজুন...", vid: "প্রোডাক্ট ভিডিও গ্যালারি", adminH: "অ্যাডমিন কন্ট্রোল সেন্টার", orderH: "অর্ডার নিশ্চিত করুন", copy: "© 2026 THE MAX | 01788350024" },
        en: { theme: "Switch Theme", lang: "বাংলা / English", admin: "Admin Panel", logout: "Logout", login: "Login Now", search: "Search your favorite product...", vid: "Product Video Gallery", adminH: "Admin Control Center", orderH: "Confirm Your Order", copy: "© 2026 THE MAX | 01788350024" }
    };

    const msg = (m) => { const t = document.getElementById('toast'); t.textContent = m; t.style.display = 'block'; setTimeout(()=>t.style.display='none',3000); };

    return {
        init: () => {
            const config = { apiKey: "AIzaSyAoZzONz8I2W70_b4oR_7cGxbQCmDaipWg", authDomain: "shop-h-215df.firebaseapp.com", projectId: "shop-h-215df", appId: "1:60483176788:web:cdadf8c99fccb3d20620c1" };
            firebase.initializeApp(config);
            db = firebase.firestore(); auth = firebase.auth();

            // Menu Bar Logic (Fixed)
            document.getElementById('menuTrigger').onclick = (e) => {
                e.stopPropagation();
                const menu = document.getElementById('navDropdown');
                menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            };
            window.onclick = () => document.getElementById('navDropdown').style.display = 'none';

            auth.onAuthStateChanged(u => {
                state.user = u;
                const box = document.getElementById('userInfoBox');
                if(u) {
                    box.innerHTML = `<div class="user-info"><img src="${u.photoURL}"><div><b>${u.displayName}</b></div></div>`;
                    document.getElementById('logoutBtn').style.display = 'flex';
                    document.getElementById('loginBtn').style.display = 'none';
                    // Master Admin Logic (Fixed)
                    if(u.email === 'nayemhossen20005@gmail.com') {
                        document.getElementById('adminPanelBtn').style.display = 'flex';
                        TheMax.loadAdminData();
                    }
                } else {
                    box.innerHTML = "";
                    document.getElementById('logoutBtn').style.display = 'none';
                    document.getElementById('loginBtn').style.display = 'flex';
                    document.getElementById('adminPanelBtn').style.display = 'none';
                }
            });

            db.collection('products').orderBy('createdAt', 'desc').onSnapshot(snap => {
                state.products = snap.docs.map(d => ({id: d.id, ...d.data()}));
                TheMax.render();
            });

            // Button Bindings
            document.getElementById('loginBtn').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
            document.getElementById('logoutBtn').onclick = () => auth.signOut();
            document.getElementById('themeToggle').onclick = () => document.documentElement.setAttribute('data-theme', document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark');
            document.getElementById('langToggle').onclick = () => TheMax.toggleLang();
            document.getElementById('adminPanelBtn').onclick = () => TheMax.toggleModal('adminModal', true);
            document.getElementById('btnSaveProd').onclick = () => TheMax.saveProduct();
            document.getElementById('pSearch').oninput = () => TheMax.render();
            document.getElementById('btnFinalOrder').onclick = () => TheMax.submitOrder();
            
            // Tab Logic
            document.getElementById('btnTabAdd').onclick = () => TheMax.switchTab('Add');
            document.getElementById('btnTabOrders').onclick = () => TheMax.switchTab('Orders');
            document.getElementById('btnTabManage').onclick = () => { TheMax.switchTab('Manage'); TheMax.renderManage(); };
        },

        toggleLang: () => {
            state.lang = state.lang === 'bn' ? 'en' : 'bn';
            const d = words[state.lang];
            document.getElementById('labelTheme').textContent = d.theme;
            document.getElementById('labelLang').textContent = d.lang;
            document.getElementById('labelAdmin').textContent = d.admin;
            document.getElementById('labelLogout').textContent = d.logout;
            document.getElementById('labelLogin').textContent = d.login;
            document.getElementById('pSearch').placeholder = d.search;
            document.getElementById('labelVidTitle').textContent = d.vid;
            document.getElementById('labelAdminHead').textContent = d.adminH;
            document.getElementById('labelOrderHead').textContent = d.orderH;
            document.getElementById('labelCopy').textContent = d.copy;
            TheMax.render();
            msg(state.lang==='bn'?"ভাষা পরিবর্তন হয়েছে":"Language Switched");
        },

        render: () => {
            const pBox = document.getElementById('pDisplay'), vBox = document.getElementById('vidDisplay'), cBox = document.getElementById('catDisplay'), term = document.getElementById('pSearch').value.toLowerCase();
            pBox.innerHTML = ""; vBox.innerHTML = ""; cBox.innerHTML = "";

            // Categories
            const uniqueCats = ['All', ...new Set(state.products.map(p => p.cat))];
            uniqueCats.forEach(c => {
                const b = document.createElement('button'); b.className = `cat-tag ${state.cat===c?'active':''}`;
                b.textContent = c==='All' ? (state.lang==='bn'?'সবগুলো':'All') : c;
                b.onclick = () => { state.cat = c; TheMax.render(); };
                cBox.append(b);
            });

            // Filter & Display
            state.products.filter(p => (state.cat==='All'||p.cat===state.cat) && p.name.toLowerCase().includes(term)).forEach(p => {
                pBox.innerHTML += `
                    <div class="card">
                                    <div class="card">
                    <img src="${p.img}" onclick="TheMax.zoomImg('${p.id}')" loading="lazy" style="cursor:zoom-in;">
                    <div class="p-info" style="padding:12px;">
                        <h3 style="font-size:16px; margin-bottom:5px; height:40px; overflow:hidden;">${p.name}</h3>
                        
                        ${p.colors && p.colors.length > 0 ? `
                        <div style="display:flex; gap:6px; margin-bottom:10px;">
                            ${p.colors.map(c => `<span style="width:16px; height:16px; border-radius:50%; background:${c}; border:1px solid rgba(255,255,255,0.2); box-shadow:0 2px 4px rgba(0,0,0,0.2);"></span>`).join('')}
                        </div>` : ''}

                        <div class="price-row" style="margin-bottom:8px;">
                            <span style="color:var(--primary); font-weight:700; font-size:19px;">৳${p.price}</span>
                            ${p.oldPrice ? `<span style="text-decoration:line-through; color:#888; margin-left:8px; font-size:13px;">৳${p.oldPrice}</span>` : ''}
                        </div>
                        <p style="font-size:12px; color:#aaa; margin-bottom:10px; line-height:1.4; height:34px; overflow:hidden;">${p.desc || ''}</p>
                        
                        <div class="meta" style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:13px; color:#888;">
                            <span onclick="TheMax.like('${p.id}')" style="cursor:pointer">
                                <i class="fas fa-heart" id="ic-l-${p.id}" style="${localStorage.getItem('L_'+p.id)?'color:var(--red)':''}"></i> <small id="ln-${p.id}">${p.likes || 0}</small>
                            </span>
                            <span onclick="TheMax.zoomImg('${p.id}')" style="cursor:pointer">
                                <i class="fas fa-comment"></i> <small>${p.comments || 0}</small>
                            </span>
                        </div>
                        <button class="order-btn" onclick="TheMax.openOrder('${p.id}')">
                            ${TheMax.t('orderNow')}
                        </button>
                    </div>
                </div>`;

            if(p.video) {
                vBox.innerHTML += `
                    <div class="vid-card">
                        <div class="iframe-wrap"><iframe src="https://www.youtube.com/embed/${p.video}" allowfullscreen></iframe></div>
                        <div style="padding:15px; font-weight:600; font-size:14px;">${p.name}</div>
                    </div>`;
            }
        });

        const nav = document.getElementById('navDropdown');
        if(nav) {
            nav.innerHTML = `
                <button class="menu-link" onclick="TheMax.toggleModal('adminModal', true)"><i class="fas fa-user-shield"></i> ${TheMax.t('adminPanel')}</button>
                <button class="menu-link" onclick="TheMax.toggleLang()"><i class="fas fa-language"></i> ${TheMax.t('langBtn')}</button>
                <button class="menu-link" onclick="TheMax.toggleTheme()"><i class="fas fa-adjust"></i> ${TheMax.t('themeBtn')}</button>
                <button class="menu-link" onclick="location.reload()"><i class="fas fa-sync"></i> ${TheMax.t('refresh')}</button>
            `;
        }
        TheMax.updateStaticTexts();
    },

    t: (key) => {
        const lang = document.documentElement.getAttribute('lang') || 'bn';
        const dictionary = {
            bn: {
                orderNow: "অর্ডার দিন", adminPanel: "অ্যাডমিন প্যানেল", langBtn: "ভাষা পরিবর্তন (English)", 
                themeBtn: "থিম পরিবর্তন", refresh: "রিফ্রেশ করুন", tabAdd: "পণ্য যোগ", tabOrders: "অর্ডার তালিকা", 
                tabManage: "ম্যানেজ", inName: "পণ্যের নাম", inPrice: "মূল্য", inDesc: "বিবরণ", 
                inColors: "কালার কোড (যেমন: red, blue)",
                custName: "আপনার নাম", custPhone: "ফোন নম্বর", custAddr: "সম্পূর্ণ ঠিকানা", comments: "মন্তব্যসমূহ"
            },
            en: {
                orderNow: "Order Now", adminPanel: "Admin Panel", langBtn: "Switch to Bangla", 
                themeBtn: "Change Theme", refresh: "Refresh", tabAdd: "Add Product", tabOrders: "Orders List", 
                tabManage: "Manage", inName: "Product Name", inPrice: "Price", inDesc: "Description", 
                inColors: "Color codes (e.g., red, blue)",
                custName: "Your Name", custPhone: "Phone Number", custAddr: "Full Address", comments: "Comments"
            }
        };
        return dictionary[lang][key] || key;
    },

    updateStaticTexts: () => {
        const T = TheMax.t;
        // ট্যাব বাটন আপডেট
        const bAdd = document.getElementById('btnTabAdd'), bOrd = document.getElementById('btnTabOrders'), bMan = document.getElementById('btnTabManage');
        if(bAdd) bAdd.innerText = T('tabAdd'); if(bOrd) bOrd.innerText = T('tabOrders'); if(bMan) bMan.innerText = T('tabManage');

        // ইনপুট প্লেসহোল্ডারগুলো ডাইনামিক করা
        const inputs = {
            'inName': 'inName', 'inPrice': 'inPrice', 'inDesc': 'inDesc', 'inColors': 'inColors',
            'cN': 'custName', 'cP': 'custPhone', 'cA': 'custAddr'
        };
        for (let id in inputs) {
            let el = document.getElementById(id);
            if(el) el.placeholder = T(inputs[id]);
        }
    },

    toggleLang: () => {
        const current = document.documentElement.getAttribute('lang') || 'bn';
        const next = current === 'bn' ? 'en' : 'bn';
        document.documentElement.setAttribute('lang', next);
        localStorage.setItem('siteLang', next);
        TheMax.render(); 
        if(document.getElementById('lightbox').style.display === 'flex' && state.selP) {
            TheMax.zoomImg(state.selP.id);
        }
    },

    toggleTheme: () => {
        const cur = document.documentElement.getAttribute('data-theme');
        document.documentElement.setAttribute('data-theme', cur === 'dark' ? 'light' : 'dark');
    },

    zoomImg: (id) => {
        const product = state.products.find(p => p.id === id);
        if(!product) return;
        state.selP = product;
        document.getElementById('zoomImg').src = product.img;
        const lb = document.getElementById('lightbox'), T = TheMax.t;
        
        let cBox = document.getElementById('commentBox');
        if(!cBox) {
            cBox = document.createElement('div');
            cBox.id = "commentBox";
            cBox.className = "comment-pane";
            cBox.style = "width:100%; max-width:550px; background:var(--card); padding:20px; border-radius:20px 20px 0 0; position:fixed; bottom:0; left:50%; transform:translateX(-50%); max-height:45vh; overflow-y:auto; border-top:3px solid var(--primary); z-index:30001;";
            lb.appendChild(cBox);
        }
        cBox.onclick = (e) => e.stopPropagation();

        cBox.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <b style="color:var(--primary); font-size:16px;">${T('comments')} (${product.comments || 0})</b>
                <button onclick="TheMax.addComment('${product.id}')" style="background:var(--primary); color:white; border:none; padding:6px 15px; border-radius:8px; font-size:12px; cursor:pointer;">${document.documentElement.getAttribute('lang')==='en'?'Add Comment':'মন্তব্য দিন'}</button>
            </div>
            <p style="font-size:13px; color:#ccc; margin-bottom:15px;">${product.desc || ''}</p>
            ${product.colors ? `<div style="display:flex; gap:8px; margin-bottom:15px;">${product.colors.map(c => `<span style="width:22px; height:22px; border-radius:50%; background:${c}; border:2px solid #fff;"></span>`).join('')}</div>` : ''}
            ${(product.allComments || []).map(c => `<div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:10px; font-size:13px; border-left:4px solid var(--primary);">${c}</div>`).join('') || ''}`;
        
        lb.style.display = 'flex';
        setTimeout(() => lb.classList.add('show'), 10);
    },

    addComment: async (id) => {
        const isEn = document.documentElement.getAttribute('lang') === 'en';
        const n = prompt(isEn ? "Name:" : "নাম:"), c = prompt(isEn ? "Comment:" : "মন্তব্য:");
        if(!n || !c) return;
        const pRef = db.collection('products').doc(id);
        const doc = await pRef.get();
        const cms = doc.data().allComments || [];
        cms.push(`${n}: ${c}`);
        await pRef.update({ allComments: cms, comments: cms.length });
        TheMax.zoomImg(id);
    },

    like: async (id) => {
        if(localStorage.getItem('L_'+id)) return;
        const pRef = db.collection('products').doc(id);
        const doc = await pRef.get();
        await pRef.update({ likes: (doc.data().likes || 0) + 1 });
        localStorage.setItem('L_'+id, '1');
        TheMax.render();
    },

    closeZoom: () => {
        const lb = document.getElementById('lightbox');
        lb.classList.remove('show');
        setTimeout(() => { 
            lb.style.display = 'none'; 
            if(document.getElementById('commentBox')) document.getElementById('commentBox').remove(); 
        }, 300);
    },

    toggleModal: (id, show) => {
        if(id === 'adminModal' && show) {
            const pass = prompt("Password:");
            if(pass !== "shopnocowa@500nayem") return alert("Access Denied!");
            const drop = document.getElementById('navDropdown');
            if(drop) drop.style.display = 'none';

            // অ্যাডমিন প্যানেল ফর্মে ইনপুট ফিল্ডটি বাস্তবে যোগ করার চূড়ান্ত লজিক
            const panelAdd = document.getElementById('panelAdd');
            if(panelAdd && !document.getElementById('inColors')) {
                const colorHtml = `<input type="text" id="inColors" class="input-field" placeholder="Color codes (red, blue, green)">`;
                // Description বক্সের ঠিক আগে এটি ইনসার্ট করা হচ্ছে
                const descBox = document.getElementById('inDesc');
                if(descBox) descBox.insertAdjacentHTML('beforebegin', colorHtml);
            }
        }
        const modal = document.getElementById(id);
        if(modal) modal.classList.toggle('open', show);
        if(show) TheMax.updateStaticTexts();
    },

    saveProduct: async () => {
        const colorInput = document.getElementById('inColors').value;
        const colorArray = colorInput ? colorInput.split(',').map(s => s.trim()) : [];
        
        const d = {
            name: document.getElementById('inName').value,
            price: document.getElementById('inPrice').value,
            oldPrice: document.getElementById('inOld').value || "",
            img: document.getElementById('inImg').value,
            colors: colorArray,
            cat: document.getElementById('inCat').value || 'General',
            video: document.getElementById('inVid').value || "",
            desc: document.getElementById('inDesc').value || "",
            likes: 0, comments: 0, allComments: [],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        if(!d.name || !d.price || !d.img) return alert("Required fields missing!");
        await db.collection('products').add(d);
        TheMax.toggleModal('adminModal', false);
        // ইনপুট রিসেট
        ['inName','inPrice','inImg','inColors','inDesc'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.value = '';
        });
    },

    openOrder: (id) => {
        state.selP = state.products.find(x => x.id === id);
        const T = TheMax.t;
        document.getElementById('orderSummary').innerHTML = `
            <div style="display:flex; gap:10px; align-items:center;">
                <img src="${state.selP.img}" style="width:50px; border-radius:5px;">
                <div><b>${state.selP.name}</b><br>${T('inPrice')}: ৳${state.selP.price}</div>
            </div>`;
        TheMax.toggleModal('orderModal', true);
    },

    submitOrder: async () => {
        const n = document.getElementById('cN').value, p = document.getElementById('cP').value, a = document.getElementById('cA').value;
        if(!n || !p || !a) return alert("Fill info!");
        await db.collection('orders').add({ pName: state.selP.name, customer: n, phone: p, address: a, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        window.open(`https://wa.me/8801788350024?text=নতুন অর্ডার: ${state.selP.name}%0Aনাম: ${n}%0Aঠিকানা: ${a}`);
        TheMax.toggleModal('orderModal', false);
    },

    switchTab: (t) => {
        ['Add', 'Orders', 'Manage'].forEach(s => {
            const p = document.getElementById('panel'+s), b = document.getElementById('btnTab'+s);
            if(p) p.style.display = s === t ? 'block' : 'none';
            if(b) b.classList.toggle('active', s === t);
        });
        if(t === 'Orders') TheMax.loadOrders();
        if(t === 'Manage') TheMax.loadManage();
    },

    loadOrders: () => {
        db.collection('orders').orderBy('createdAt', 'desc').onSnapshot(snap => {
            const list = document.getElementById('orderListView');
            if(list) list.innerHTML = snap.docs.map(doc => `
                <div style="padding:15px; border:1px solid var(--border); border-radius:10px; margin-bottom:10px; position:relative;">
                    <b>${doc.data().pName}</b><br>
                    <span>${doc.data().customer} (${doc.data().phone})</span><br>
                    <small>${doc.data().address}</small>
                    <i class="fas fa-trash" onclick="TheMax.del('orders','${doc.id}')" style="position:absolute; right:15px; top:15px; color:var(--red); cursor:pointer;"></i>
                </div>`).join('') || "অর্ডার নেই";
        });
    },

    loadManage: () => {
        const list = document.getElementById('productManageView');
        if(list) list.innerHTML = state.products.map(p => `
            <div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid var(--border); align-items:center;">
                <span>${p.name}</span>
                <i class="fas fa-trash" onclick="TheMax.del('products','${p.id}')" style="color:var(--red); cursor:pointer;"></i>
            </div>`).join('');
    },

    del: async (col, id) => {
        if(confirm("Confirm Delete?")) await db.collection(col).doc(id).delete();
    }
};
})();

(function() {
    const s = localStorage.getItem('siteLang') || 'bn';
    document.documentElement.setAttribute('lang', s);
})();

TheMax.init();
</script>
</body>
</html>
